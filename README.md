# 2DollarDMX

![](images/the_forest.gif)

An expandable, open-source platform for controlling arrays of Solid State Relays from [Arduino](https://www.arduino.cc/) and [Raspberry Pi](https://www.raspberrypi.org/) with the [CD4094](https://www.alldatasheet.com/datasheet-pdf/pdf/26896/TI/CD4094.html). At the time, it seemed like a cheap alternative to buying a proper [DMX system](https://en.wikipedia.org/wiki/DMX512).

## Installation (OSX)

**Arduino**

1. Download and Install the Arduino IDE
1. Install the TimerOne library: `cd ~/Documents/Arduino/libraries; git clone https://github.com/PaulStoffregen/TimerOne`
1. Clone this repository: `git clone https://github.com/phillipdavidstearns/2DollarDMX.git`

**Raspberry Pi**

1. Clone this repository: `git clone https://github.com/phillipdavidstearns/2DollarDMX.git`
1. Clone rpi-cd4094: `git clone https://github.com/phillipdavidstearns/rpi-cd4094.git`
1. Install rpi-cd4094: `cd rpi-cd4094; sudo python3 setup.py install`

## System Overview

* Theory of Operation
* Hardware
* Software

### Theory of Operation

![](images/raspberry_pi_zero_schem.png)

* The 2DollarDMX system allows for the control of binary, on-off AC powered devices (e.g. lights, fans, blenders, TVs, etc...).
* This is accomplished by switching 120/240VAC using solid state relays.
* Relays are chosen based on application but generally are designed to handle 25A loads and controlled by 3.3V-5V pulses.
* Control signals are generated by user-customizable software and low-cost hardware platforms such as Arduino and Raspberry Pi.
* The CD4094, an 8-bit latched shift register from the CMOS 4000 logic family IC, is used to extend the number of controllable devices.
* Either and Arduino of Raspberry Pi control the CD4094 using a mere 4 pins. It's possible for multiple CD4094 ICs to be daisy chained to expand the number of controllable channels.



### Max channels?

#### Arduino

Operations per bit (and cost in clock cycles) using port manipulation. Timings based on [this post](https://timodenk.com/blog/port-manipulation-and-arduino-digitalwrite-performance/).

**Shifting Data into the Register:**

* set data pin (2 clock cycles)
* set clock pin HIGH (2 clock cycles)
* set clock pin LOW (2 clock cycles)
* 6 cycles total per channel

**Updating Register (strobe the latch)**

* set strobe pin HIGH (2 clock cycles)
* set strobe pin LOW (2 clock cycles)
* 4 cycles to update

**Theoretical Max Number of Channels**

* Cycles per frame @ 30 fps = 16Mhz / 30fps = 533,333 cycles per frame
* 533,333 cycles per frame - 4 cycles to strobe = 533,329 cycles
* 533,329 cycles / 6 cycles per channel = 88,888 channels

#### Raspberry Pi

Although the processor is much faster on the Raspberry Pi that that of the Arduino, running the GPIO at large percentage of the available CPU speed will consume massive amounts of energy. To look at the problem from a different angle, you could calculate the minimum required clock speed for a given number of channels.

* number of channels x cycles per channel + 4 x number of updates per second = minimum required clock rate
* 2048 elements per frame @ 30 frames per second would require a clock rate of 368760Hz (2048 x 6 + 4 x 30)